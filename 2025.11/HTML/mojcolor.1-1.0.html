<!doctype html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <style>
        #inp{
            font-size: 64px;
            width: 100%;
            ;
        }
    </style>
</head>
<body>
    <input id="inp" placeholder="ここに文字を打つと文字の色が変わります。">
    <button id="switch_on" onclick="switch_sy('on')">色変更をONにする(現在: OFF)</button>
    <button id="switch_off" onclick="switch_sy('off')">色変更をOFFにする(現在: ON)</button>
    <button id="colorcode_op" onclick="op('rgb','rgbColorCode')">rgbカラーコードを表示</button>
    <button id="createURL" onclick="op('+url','createURL')">URLを作る</button>
    <input id="color_inp" placeholder="rgbカラーコードを入力" style="display:none">
</body>
<script>
    const  El = [
        document.getElementById("inp"),
        document.getElementById("switch_on"),
        document.getElementById("switch_off"),
        document.getElementById("color_inp"),
        document.getElementById("createURL")
    ]
    Color = [
        "rgb(0, 0, 0)",/*色管理用(今の色)*/
        "rgb(0, 0, 0)",/*入力された色コード*/
    ]
    data = []
    const url = new URL(window.location.href);
    const params = new URLSearchParams(window.location.search);
    El[1].style.display="none"
    El[2].style.display="block"
    if (params.has("text")){
        El[0].value=decodeURI(params.get("text"))
    }
    if (params.has("color")){
        if (params.get("color")=="rd"){
            Color[0]=`rgb(${Math.floor(Math.random()*256)}, ${Math.floor(Math.random()*256)}, ${Math.floor(Math.random()*256)})`
            El[0].style.color=Color[0]
        }else{
            Color[0]="#"+decodeURI(params.get("color"))
            El[0].style.color=Color[0]
        }
    }
    if (params.has("mode")){
        if (params.get("mode")==1 || params.get("mode")=="on"){
            switch_sy("on")
        }else if (params.get("mode")==0 || params.get("mode")=="off"){
            switch_sy("off")
        }
    }

    url.search=""//パラメータの削除
    history.replaceState("","",url.toString())//urlの書き換え
    document.title="文字ランダム色変換 - v1.0.0"

    El[0].addEventListener("input",()=>{
    if (El[1].style.display=="none"/*もし色変更がオンなら*/){
        Color[0]=`rgb(${Math.floor(Math.random()*256)}, ${Math.floor(Math.random()*256)}, ${Math.floor(Math.random()*256)})`
            El[0].style.color=Color[0]
        }
    })
    El[3].addEventListener("keyup",()=>{
        if (El[2].style.display=="none"/*もし色変更がオフなら*/){
            El[0].style.color=El[3].value
            Color[0]=El[0].style.color
        }
    })
    function switch_sy(onoff){
        if (onoff=="on" || onoff==1){
            El[1].style.display="none"
            El[2].style.display="block"
            El[3].style.display="none"
            data[0]="on"
        }else if(onoff=="off" || onoff==0){
            El[1].style.display="block"
            El[2].style.display="none"
            El[3].style.display="block"
            data[0]="off"
        }
    }
    function op(about, comment, return_=true){
        if (about=="rgb" || about=="RGB" || about==0){
            Color[3]=El[0].style.color
            Color[3]=Color[3].replaceAll("rgb","").replaceAll("(","").replaceAll(")","").replaceAll(" ","").split(",")
            Color[3]=[
                Number(Color[3][0]).toString(16).padStart(2,0),
                Number(Color[3][1]).toString(16).padStart(2,0),
                Number(Color[3][2]).toString(16).padStart(2,0),
            ]
            if (return_){
                alert(`現在のRGBカラーコード: #${Color[3].join("")}`)
            }
        }
        if (about=="+url" || about=="createURL" || about==1){
            op("rgb", "作る", false)
            data[1]=`${url.href}?text=${encodeURI(El[0].value)}&color=${Color[3].join("").replaceAll(NaN,"00")}&mode=${data[0] ?? "on"}`
            alert(data[1])
        }
    }
</script>
</html>
